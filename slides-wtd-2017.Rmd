---
title: "The Verifiability Crisis in Science, Tech Writing, and Life"
author: Carl Parker
date: May 14, 2017
output: 
  ioslides_presentation:
    css: styles.css
    widescreen: true
---

# Part 1: The Replication Crisis in Science


## The Experiment Experiment    {.embiggen}  

In 2008, team of investigators led by Brian Nosek set out to replicate
the findings from <b>hundred</b> peer-reviewed published research papers
in the area of psychology.

NPR later referred to Nosek's work as <i>The Experiment Experiment</i>.

## {.vertical-high}

![](images/science-experiment.png)


## The Experiment Experiment 

![](images/science-experiment.png)

<http://science.sciencemag.org/content/349/6251/aac4716>


## The Experiment Experiment    {.embiggen} 

At of the 100 experiments that Nosek's investigated . . .

. . . only <b>39</b> could be replicated.


<!--
## More Studies...Similar Results

According to a 2016 poll of 1,500 scientists reported in the journal
Nature, 70% of them had failed to reproduce at least one other
scientist's experiment and 50% had failed to reproduce one of their own
experiments. 

chemistry                      |  90% (60%)
biology                        |  80% (60%)
physics and engineering        |  70% (50%)
medicine                       |  70% (60%)
Earth and environment science  |  60% (40%)
-->


## Replication Crisis

The <b>replication crisis</b> (or replicability crisis) refers to a
methodological crisis in science in which scientists have found that the
results of many scientific experiments are difficult or impossible to
replicate on subsequent investigation, either by independent researchers
or _by the original researchers themselves_.

From Wikipedia, the free encyclopedia
<https://en.wikipedia.org/wiki/Replication_crisis#Marketing>


## Reproducible Research 1

<!--

<div class = "columns-2">
![](images/peng-roger-linkedin.jpeg)

-->


Roger Peng (Johns Hopkins) proposed the idea of Reproducible Research.\*

- <i>Replication</i>, the ability to re-enact the experiment was too
  high a bar.

- Instead, <i>Reproducibility</i>, the ability to reach the same
  conclusions given the same data and computational software.

- Reproduciblity requires that any published research make available
  both data that was collected and the code that processed the data.


\* Reproducible Research in Computational Science, Science, Dec, 2011


## Reproducible Research 2

An article about computational science in a scientific publication is
not the scholarship itself, it is merely advertising the scholarship.

Dave Donoho, Stanford University
                                                                                   

## Enabling Reproducible Research

One of the barriers to reproducible research is that the code used to
produce the research is usually maintained separately from the research
paper itself.

The paper is published, but the code becomes . . . misplaced.

The solution was to find a way to _keep the research paper and the code
together_.


## RMarkdown and Knitr 1   {.embiggen}  


<b>RMarkdown</b></br>
Extensions to enable Markdown to embed executable code.


<b>Knitr</b></br>
Tool that builds the RMarkdown to various output formats.


## RMarkdown and Knitr 2

![](images/knitr-process.png)


## Reproducibility Ecosystem    {.embiggen}  

- RMarkdown, 
- Knitr
- GitHub


## The Takeaway   {.embiggen}  

Code that supports the document is embedded in the document and is
executed when the document is built.


# Part 2: Tech Writing, Reproducibility, and Code


## A long time ago at a company not far away . . . Code Samples   {.embiggen}  

- Intel Tech Support
- Hillsboro, OR
- Year: 1988
- Email: No
- Code samples: Yes


##  Transitioning the i386 to Protected Mode

![](images/i386.png)


## Definition: Byzantine

![](images/byzantine-defn.png)


## Keeping Docs and Sample Code Separate   {.embiggen}  

- Verifying that the code snippets in the docs work.
- Keeping the code snippets in the docs synch'd with the actual code.
- Providing the customer with enough information to reproduce the result.


<!--

## {.embiggen .embolden .vertical-high}

<div class = "centered" >
<p>Writing About Software</p>
<p>vs</p>
<p>Enabling Reproducible Experiences</p>
</div>

-->


## Example: R {.codefont}

```{r}
n <- 5

for( i in 1:n ) {
    print( i ^ 2 )
}
```


## Example: Python {.codefont}

```{python}
n = 5

for i in range( 1, n ):
    print( i ** 2 )
```

## Language Support in Knitr   {.embiggen}  

- R
- C / C++
- Python
- Ruby
- Perl
- Bash
- And others . . .

<div class="notes">

Notably absent: 

- Java 
- C#

</div>

<!--
**Complete list of supported languages**

<http://rmarkdown.rstudio.com/authoring_knitr_engines.html#rcpp>
-->


## Similar Technologies: Knitpy

- [knitpy](https://github.com/janschulz/knitpy/blob/master/README.md) (and [stitch](https://github.com/pystitch/stitch/blob/master/README.rst))
- Similar to Knitr, but with enhanced support for Python.


## Similar Technologies: Jupyter Notebooks   {.embiggen}  

- Interactive code mixed with expository text.
- Supports Python, R, and other languages.

## Similar Technologies: Bootstrap

- [Bootstrap](http://getbootstrap.com/examples/navbar-static-top/#)
- The HTML documentation for Bootstrap uses Bootstrap for styling.

<!--
- Storyteller
- Executable Specifications (Microsoft).
-->

<div class="notes">

I am demo'ing R because I am most familiar with R.

Nice example of simultaneous invention.

</div>


# Part 3: Social Discourse, Misinformation, and Fake News


## {.embiggen .embolden .vertical-high}

Lies, Fake News, and Statistics


<div class="notes">

For this part, I need you to use you imagination.

</div>


## Lies, Fake News, and Statistics

<div class = "centered">
![](images/2017-03-19-weaponized-lies-resized.png)
</div>


<!--
![](images/20170331-veracity.png)
-->


## Lies, Fake News, and Statistics

![](images/kirk-59029681247aa891782881.gif)


## Fake News vs Verifiable News


## Example: How close was the election really?

What if 1% of those who votes for Donald Trump--on a state-by-state
basis had voted for Hillary Clinton instead?

We have all the information we need to answer the question and publish
the result.

<!--
![](images/credible-hulk-YxhdDzN__400x400.png)
-->


```{r warning = FALSE, message = FALSE, echo = FALSE}
library(maps)
id.state <- c( 1:19, 20, 20, 20, 21, 21, 22:30, 31, 31, 31, 31, 32, 32, 32, 33:44, 45, 45, 45, 46, 46, 46, 46, 46, 47, 48, 49 )
col.state <- ifelse( id.state %% 2 == 0, "red", "blue" )
```

## What actually happened  {.vertical}

```{r warning = FALSE, message = FALSE, echo = FALSE, fig.align = "center", fig.height = 7, fig.width = 8}
states <- map(database = "state", fill = TRUE, col = col.state )
```


## What actually happened


```{r warning = FALSE, message = FALSE, echo = FALSE, fig.align = "center"}
library( ggplot2 )
library( fiftystater )

data( "fifty_states" ) # this line is optional due to lazy data loading

crimes <- data.frame( state = tolower( rownames( USArrests ) ), USArrests )

# map_id creates the aesthetic mapping to the state name column in your data

p <- ggplot( crimes, aes( map_id = state ) ) + 
  # map points to the fifty_states shape data
  geom_map( aes( fill = Assault ), map = fifty_states ) + 
  expand_limits( x = fifty_states$long, y = fifty_states$lat ) +
  coord_map( ) +
  scale_x_continuous( breaks = NULL ) + 
  scale_y_continuous( breaks = NULL ) +
  labs( x = "", y = "" ) +
  theme( legend.position = "bottom", 
        panel.background = element_blank( ) )

# add border boxes to AK/HI
p + fifty_states_inset_boxes( ) 

```


## Get the Electoral Votes 

![](images/electoral-votes-wikipedia-20170509.png)

Ref: [Current electoral vote distribution](https://en.wikipedia.org/wiki/Electoral_College_(United_States)#Current_electoral_vote_distribution) 


## Get the Electoral Votes  {.codefont-small}

```{r warning = FALSE, message = FALSE, echo = FALSE}
library( rvest )
```

Get the electoral votes from Wikipedia.

```{r warning = FALSE, message = FALSE}
wiki.elect.votes <- c( 
  "https://en.wikipedia.org/wiki/Electoral_College_(United_States)#Current_electoral_vote_distribution"
)
```
Convert the HTML table into an R dataframe.
```{r warning = FALSE, message = FALSE}
evotes.wiki.df <- read_html( wiki.elect.votes )  %>%
  html_nodes( "table.wikitable:nth-child(103)" ) %>% 
  html_table()
```
```{r warning = FALSE, message = FALSE, echo = FALSE}
evotes.wiki.df <- evotes.wiki.df[[1]]
evotes.wiki.df <- evotes.wiki.df[ -( 20 ), ] 
names( evotes.wiki.df ) <- c( "EV", "States" )
evotes.wiki.df$EV <- strsplit( evotes.wiki.df$EV, " " )
evotes.wiki.df$EV <- unlist( lapply( evotes.wiki.df$EV, function( li ) as.numeric( unlist( li )[ 1 ] ) ) )
evotes.df <- data.frame()
```
```{r warning = FALSE, message = FALSE, echo = FALSE}
for( row.idx in 1:nrow( evotes.wiki.df ) ) {
  states.vec <- trimws( unlist( strsplit( evotes.wiki.df[ row.idx, 2 ], "," ) ) )
  evotes.df  <- rbind( evotes.df, cbind( states.vec, evotes.wiki.df[ row.idx, 1] ) )
}
names( evotes.df ) <- c( "State", "Electoral Votes" )
```

## Get the Electoral Votes {.codefont-small}

Display the first few rows of the data.

```{r warning = FALSE, message = FALSE}
knitr::kable( head( evotes.df, 3 ) )
```

## Get the Popular Vote  {.codefont-small} 

![](images/google-at-cook.png)

<https://docs.google.com/spreadsheets/d/133Eb4qQmOxNvtesw2hdVns073R68EZx4SfCnP4IGQf8>


## Get the Popular Vote  {.codefont-small} 

```{r warning = FALSE, message = FALSE, echo = FALSE}
#
# --- Library Dependencies ---
#
library( magrittr )
library( dplyr )
library( googlesheets )

electoral.votes.df <- read.csv( 
                        "data/electoral-college.csv",
                         header = FALSE, 
                         quote="\"",
                         sep = ",", 
                         na.strings = c( "NA", "-" ),
                         allowEscapes = TRUE,
                         strip.white  = TRUE,
                         stringsAsFactors = TRUE,
                         comment.char="#" 
                       )

names( electoral.votes.df ) <- c( "Electoral.Votes", "State" )
electoral.votes.df$State    <- gsub( "\\*", "", electoral.votes.df$State )
```

Retrieve the certified popular votes from the Cook Report's Google spreadsheet.

```{r warning = FALSE, message = FALSE, echo = TRUE}
official.gs <- gs_url( c( "https://docs.google.com/spreadsheets/d/133Eb4qQmOxNvtesw2hdVns073R68EZx4SfCnP4IGQf8/" ) ) 
votes.df <- official.gs %>% gs_read( range = "A12:D24", col_names = FALSE )
```
```{r warning = FALSE, message = FALSE, echo = FALSE}
swing.df   <- official.gs %>% gs_read( range = "A12:D24", col_names = FALSE ) %>% data.frame()
noswing.df <- official.gs %>% gs_read( range = "A27:D64", col_names = FALSE ) %>% data.frame()
votes.df <- rbind( swing.df, noswing.df )
names( votes.df  )<- c( "State", "Clinton", "Trump", "Other" )
votes.df$State <- gsub( "\\*", "", votes.df$State )
```

View the first few rows.

```{r warning = FALSE, message = FALSE}
knitr::kable( head( votes.df, 3 ) )
```

## Combine with the ELectoral Vote  {.codefont-small} 

Merge in the electoral vote information.

```{r}
votes.df <- merge( votes.df, electoral.votes.df )
```
View the first few rows

```{r warning = FALSE, message = FALSE}
knitr::kable( head( votes.df, 3 ) )
```

## Calculate Electoral Vote Totals {.codefont-small} 

Count the actual electoral votes for each candidate.

**Trump**
```{r}
sum( filter( votes.df, Trump > Clinton )$Electoral.Votes ) 
```

**Clinton**
```{r}
sum( filter( votes.df, Trump < Clinton )$Electoral.Votes ) 
```

```{r echo = FALSE}
attach( votes.df )

Trump.recount   <- 0
Clinton.recount <- 0
```

## Transfer 1% of Popular Vote  {.codefont-small} 

Take one percent of President Trump's popular vote from each state.
Subtract it from his total. Add it to Hillary Clinton's total.

```{r}
Trump.one.pct <- floor( Trump * 0.1 ) 

votes.df$Trump.recount   <- Trump   - Trump.one.pct 
votes.df$Clinton.recount <- Clinton + Trump.one.pct 
```

```{r echo = FALSE}
Winner <- ifelse( Trump.recount > Clinton.recount, "Trump", "Clinton" ) 

detach( votes.df )
```

## Calculate the Hypothetical Electoral Vote Totals  {.codefont-small} 

Calculate the new electoral vote totals.

**Trump**
```{r}
sum( filter( votes.df, Trump.recount > Clinton )$Electoral.Votes ) 
```

**Clinton**
```{r}
sum( filter( votes.df, Trump.recount < Clinton )$Electoral.Votes ) 
```

The states that flipped were: Wisconsin, Michigan, and Pennsylvania.


# Conclusion



